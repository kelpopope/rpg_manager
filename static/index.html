<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RPG Manager - Login</title>
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Roboto', sans-serif; 
            background-color: #1a1a1d; 
            color: #c5c6c7; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            background-image: radial-gradient(circle, #2c3e50 0%, #000000 100%);
        }
        .container { 
            background-color: #0b0c10; 
            padding: 40px; 
            border: 2px solid #d4af37; 
            border-radius: 15px; 
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.2); 
            text-align: center; 
            width: 320px; 
        }
        h2 { font-family: 'MedievalSharp', cursive; color: #d4af37; font-size: 28px; margin-bottom: 20px; }
        
        input { 
            width: 90%; padding: 12px; margin: 10px 0; 
            background: #1f2833; border: 1px solid #45a29e; 
            color: white; border-radius: 5px; outline: none;
        }
        input:focus { border-color: #66fcf1; box-shadow: 0 0 5px #66fcf1; }
        
        button { 
            width: 100%; padding: 12px; margin-top: 15px;
            background: linear-gradient(45deg, #d4af37, #c5a028); 
            color: #0b0c10; font-weight: bold; font-family: 'MedievalSharp', cursive; font-size: 18px;
            border: none; border-radius: 5px; cursor: pointer; transition: 0.3s;
        }
        button:hover { transform: scale(1.05); box-shadow: 0 0 15px #d4af37; }
        
        .switch { margin-top: 20px; font-size: 14px; color: #66fcf1; cursor: pointer; text-decoration: underline; }
        .switch:hover { color: white; }
    </style>
</head>
<body>

<div class="container">
    <h2 id="title">üõ°Ô∏è Guild Login</h2>
    <input type="text" id="username" placeholder="Master Name">
    <input type="password" id="password" placeholder="Secret Password">
    <input type="email" id="email" placeholder="Email (for registration)" style="display: none;">
    
    <button onclick="handleAuth()" id="actionBtn">Open the Gates</button>
    <div class="switch" onclick="toggleMode()" id="switchText">No account? Swear loyalty</div>
</div>

<script>
    let isLogin = true;

    function toggleMode() {
        isLogin = !isLogin;
        document.getElementById('title').innerText = isLogin ? "üõ°Ô∏è Guild Login" : "üìú New Master";
        document.getElementById('actionBtn').innerText = isLogin ? "Open the Gates" : "Record in Chronicles";
        document.getElementById('switchText').innerText = isLogin ? "No account? Swear loyalty" : "Already have an account? Login";
        document.getElementById('email').style.display = isLogin ? "none" : "block";
    }

    async function handleAuth() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const email = document.getElementById('email').value;

        if (!isLogin) {
            const response = await fetch(`/auth/register?password=${password}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ "username": username, "email": email })
            });
            if (response.ok) { 
                alert("Success! Now please login."); 
                toggleMode(); 
            } 
            else { 
                const data = await response.json(); 
                alert("Error: " + data.detail); 
            }
        } else {
            const response = await fetch(`/auth/login?username=${username}&password=${password}`, { method: 'POST' });
            if (response.ok) { 
                localStorage.setItem('user', username); 
                window.location.href = '/static/dashboard.html'; 
            } 
            else { 
                alert("Invalid username or password"); 
            }
        }
    }
</script>
</body>
</html>